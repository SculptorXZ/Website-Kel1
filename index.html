<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Manajemen Perpustakaan</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- LOGIN FORM -->
        <div id="login-section">
            <header class="center-header">
                <h1><i class="fas fa-user-lock"></i> Login</h1>
                <p>Masukkan kredensial Anda untuk mengakses sistem</p>
            </header>
            <main class="center-main">
                <div class="form-container card center-form">
                    <h2><i class="fas fa-sign-in-alt"></i> Masuk ke Akun</h2>
                    <div class="form-group">
                        <label for="username">Username:</label>
                        <input type="text" id="username" placeholder="Masukkan username" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password:</label>
                        <input type="password" id="password" placeholder="Masukkan password" required>
                    </div>
                    <div class="form-actions center-actions">
                        <button class="btn btn-primary" onclick="login()">
                            <i class="fas fa-sign-in-alt"></i> Masuk
                        </button>
                    </div>
                    <div style="text-align:center; margin-top:10px;">
                        <a href="#" onclick="showRegister()">Belum punya akun? Register di sini</a>
                    </div>
                    <div id="login-alert" class="center-alert" style="display: none;"></div>
                </div>
            </main>
        </div>

        <!-- REGISTRATION FORM -->
        <div id="register-section" style="display:none;">
            <header class="center-header">
                <h1><i class="fas fa-user-plus"></i> Register</h1>
                <p>Buat akun baru untuk mengakses sistem</p>
            </header>
            <main class="center-main">
                <div class="form-container card center-form">
                    <h2><i class="fas fa-user-plus"></i> Daftar Akun</h2>
                    <div class="form-group">
                        <label for="reg-username">Username:</label>
                        <input type="text" id="reg-username" placeholder="Masukkan username" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-password">Password:</label>
                        <input type="password" id="reg-password" placeholder="Masukkan password" required>
                    </div>
                    <div class="form-actions center-actions">
                        <button class="btn btn-primary" onclick="register()">
                            <i class="fas fa-user-plus"></i> Daftar
                        </button>
                        <button class="btn btn-secondary" onclick="showLogin()">
                            <i class="fas fa-sign-in-alt"></i> Kembali ke Login
                        </button>
                    </div>
                    <div id="register-alert" class="center-alert" style="display: none;"></div>
                </div>
            </main>
        </div>

        <!-- PERPUS MAIN SECTION -->
        <div id="main-section" style="display:none;">
            <header class="center-header">
                <h1><i class="fas fa-book-open"></i> Sistem Manajemen Perpustakaan</h1>
                <p>Kelola koleksi buku Anda dengan mudah</p>
            </header>
            <main class="center-main">
                <div class="menu center-menu">
                    <button class="btn btn-primary" onclick="showForm('add-book')">
                        <i class="fas fa-plus"></i> Tambah Buku
                    </button>
                    <button class="btn btn-secondary" onclick="showAllBooks()">
                        <i class="fas fa-list"></i> Tampilkan Semua Buku
                    </button>
                    <button class="btn btn-secondary" onclick="showForm('search-book')">
                        <i class="fas fa-search"></i> Cari Buku
                    </button>
                    <button class="btn btn-danger" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
                <!-- Form Tambah Buku -->
                <div id="add-book" class="form-container card center-form" style="display: none;">
                    <h2><i class="fas fa-book-medical"></i> Tambah Buku Baru</h2>
                    <div class="form-group">
                        <label for="judul">Judul Buku:</label>
                        <input type="text" id="judul" placeholder="Masukkan judul buku" required>
                    </div>
                    <div class="form-group">
                        <label for="penulis">Penulis:</label>
                        <input type="text" id="penulis" placeholder="Masukkan nama penulis" required>
                    </div>
                    <div class="form-group">
                        <label for="penerbit">Penerbit:</label>
                        <input type="text" id="penerbit" placeholder="Masukkan nama penerbit" required>
                    </div>
                    <div class="form-group">
                        <label for="tahun">Tahun Terbit:</label>
                        <input type="number" id="tahun" placeholder="Masukkan tahun terbit" required>
                    </div>
                    <div class="form-actions center-actions">
                        <button class="btn btn-primary" onclick="addBook()">
                            <i class="fas fa-save"></i> Simpan Buku
                        </button>
                        <button class="btn btn-danger" onclick="hideForms()">
                            <i class="fas fa-times"></i> Batal
                        </button>
                    </div>
                </div>
                <!-- Form Cari Buku -->
                <div id="search-book" class="form-container card center-form" style="display: none;">
                    <h2><i class="fas fa-search"></i> Cari Buku</h2>
                    <div class="form-group">
                        <label for="search-judul">Judul Buku:</label>
                        <input type="text" id="search-judul" placeholder="Masukkan judul buku yang dicari" required>
                    </div>
                    <div class="form-actions center-actions">
                        <button class="btn btn-primary" onclick="searchBook()">
                            <i class="fas fa-search"></i> Cari
                        </button>
                        <button class="btn btn-danger" onclick="hideForms()">
                            <i class="fas fa-times"></i> Batal
                        </button>
                    </div>
                </div>
                <!-- Daftar Buku -->
                <div id="book-list" class="book-list-container center-content" style="display: none;">
                    <h2><i class="fas fa-book"></i> Daftar Buku</h2>
                    <div id="books-container" class="book-list center-list"></div>
                </div>
                <!-- Hasil Pencarian -->
                <div id="search-results" class="search-results-container center-content" style="display: none;">
                    <h2><i class="fas fa-search"></i> Hasil Pencarian</h2>
                    <div id="search-result-container" class="book-list center-list"></div>
                </div>
                <!-- Alert Message -->
                <div id="alert-message" class="center-alert" style="display: none;"></div>
            </main>
        </div>
        <footer class="center-footer">
            <p>&copy; 2025 Sistem Perpustakaan Digital. Dibuat oleh Mahasiswa UNIMED Kelompok 1 Program WEB PTIK D23</p>
        </footer>
    </div>
    <script>
        // LOGIN LOGIC
        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            const alertDiv = document.getElementById('login-alert');

            // Admin tetap lokal
            if (username === 'admin' && password === 'admin') {
                currentRole = 'admin';
                alertDiv.innerHTML = `<div class="alert alert-success"><i class="fas fa-check-circle"></i> Login berhasil sebagai admin!</div>`;
                alertDiv.style.display = 'block';
                setTimeout(() => {
                    document.getElementById('login-section').style.display = 'none';
                    document.getElementById('main-section').style.display = 'block';
                    if (books.length > 0) showAllBooks();
                    updateMenuByRole();
                }, 1000);
                return;
            }

            // Cek ke server
            fetch('login.php', {
                method: 'POST',
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                body: `username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    currentRole = data.role || 'user';
                    alertDiv.innerHTML = `<div class="alert alert-success"><i class="fas fa-check-circle"></i> Login berhasil!</div>`;
                    alertDiv.style.display = 'block';
                    setTimeout(() => {
                        document.getElementById('login-section').style.display = 'none';
                        document.getElementById('main-section').style.display = 'block';
                        if (books.length > 0) showAllBooks();
                        updateMenuByRole();
                    }, 1000);
                } else {
                    alertDiv.innerHTML = `<div class="alert alert-danger"><i class="fas fa-exclamation-circle"></i> Username atau password salah!</div>`;
                    alertDiv.style.display = 'block';
                }
            })
            .catch(() => {
                alertDiv.innerHTML = `<div class="alert alert-danger"><i class="fas fa-exclamation-circle"></i> Gagal terhubung ke server!</div>`;
                alertDiv.style.display = 'block';
            });
        }
        function logout() {
            document.getElementById('main-section').style.display = 'none';
            document.getElementById('login-section').style.display = 'block';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('login-alert').style.display = 'none';
            currentRole = '';
        }

        // REGISTRATION LOGIC
        function showRegister() {
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('register-section').style.display = 'block';
            document.getElementById('register-alert').style.display = 'none';
        }
        function showLogin() {
            document.getElementById('register-section').style.display = 'none';
            document.getElementById('login-section').style.display = 'block';
            document.getElementById('login-alert').style.display = 'none';
        }
        // Simpan user ke localStorage
        function register() {
            const username = document.getElementById('reg-username').value.trim();
            const password = document.getElementById('reg-password').value.trim();
            fetch('register.php', {
                method: 'POST',
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                body: `username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`
            })
            .then(res => res.text())
            .then(data => {
                if (data === "success") {
                    let users = JSON.parse(localStorage.getItem('users')) || [];
                    users.push({ username: username, password: password, role: 'user' });
                    localStorage.setItem('users', JSON.stringify(users));
                    alert("Registrasi berhasil!");
                    showLogin();
                } else {
                    alert("Registrasi gagal!");
                }
            });
        }

        // PERPUS LOGIC
        let books = JSON.parse(localStorage.getItem('libraryBooks')) || [];
        let currentRole = '';
        function showAlert(message, type) {
            const alertDiv = document.getElementById('alert-message');
            alertDiv.innerHTML = `
                <div class="alert alert-${type} animated">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                    ${message}
                </div>
            `;
            alertDiv.style.display = 'block';
            setTimeout(() => {
                alertDiv.style.display = 'none';
            }, 3000);
        }
        function showForm(formId) {
            document.querySelectorAll('.form-container').forEach(form => {
                form.style.display = 'none';
            });
            document.getElementById('book-list').style.display = 'none';
            document.getElementById('search-results').style.display = 'none';
            document.getElementById(formId).style.display = 'block';
        }
        function hideForms() {
            document.querySelectorAll('.form-container').forEach(form => {
                form.style.display = 'none';
            });
            document.getElementById('book-list').style.display = 'none';
            document.getElementById('search-results').style.display = 'none';
        }
        function addBook() {
            const judul = document.getElementById('judul').value.trim();
            const penulis = document.getElementById('penulis').value.trim();
            const penerbit = document.getElementById('penerbit').value.trim();
            const tahun = document.getElementById('tahun').value.trim();
            if (judul && penulis && penerbit && tahun) {
                const newBook = {
                    id: Date.now(),
                    judul: judul,
                    penulis: penulis,
                    penerbit: penerbit,
                    tahun: tahun
                };
                books.push(newBook);
                localStorage.setItem('libraryBooks', JSON.stringify(books));
                document.getElementById('judul').value = '';
                document.getElementById('penulis').value = '';
                document.getElementById('penerbit').value = '';
                document.getElementById('tahun').value = '';
                showAlert('Buku berhasil ditambahkan!', 'success');
                hideForms();
                showAllBooks();
            } else {
                showAlert('Harap isi semua field!', 'danger');
            }
        }
        function updateMenuByRole() {
            // Tambah Buku & Hapus Buku hanya untuk admin
            document.querySelector('button[onclick="showForm(\'add-book\')"]').style.display = (currentRole === 'admin') ? 'inline-block' : 'none';
            // Hapus buku di daftar
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.style.display = (currentRole === 'admin') ? 'inline' : 'none';
            });
        }
        function showAllBooks() {
            document.querySelectorAll('.form-container').forEach(form => {
                form.style.display = 'none';
            });
            document.getElementById('search-results').style.display = 'none';
            const container = document.getElementById('books-container');
            container.innerHTML = '';
            if (books.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-book-open"></i>
                        <h3>Tidak ada buku dalam daftar</h3>
                        <p>Tambahkan buku baru untuk memulai</p>
                    </div>
                `;
            } else {
                books.forEach((book, index) => {
                    const bookDiv = document.createElement('div');
                    bookDiv.className = `book-item animated delay-${index % 3}`;
                    bookDiv.innerHTML = `
                        <h3>${book.judul}</h3>
                        <p><i class="fas fa-user-edit"></i> ${book.penulis}</p>
                        <p><i class="fas fa-building"></i> ${book.penerbit}</p>
                        <div class="book-meta">
                            <span><i class="fas fa-calendar-alt"></i> ${book.tahun}</span>
                            <span class="delete-btn" style="display:${currentRole === 'admin' ? 'inline' : 'none'}" onclick="deleteBook(${book.id})">
                                <i class="fas fa-trash"></i> Hapus
                            </span>
                        </div>
                    `;
                    container.appendChild(bookDiv);
                });
            }
            document.getElementById('book-list').style.display = 'block';
            updateMenuByRole();
        }
        function searchBook() {
            const searchTerm = document.getElementById('search-judul').value.trim().toLowerCase();
            const resultsContainer = document.getElementById('search-result-container');
            resultsContainer.innerHTML = '';
            if (!searchTerm) {
                showAlert('Harap masukkan judul buku yang ingin dicari!', 'danger');
                return;
            }
            const foundBooks = books.filter(book => 
                book.judul.toLowerCase().includes(searchTerm)
            );
            if (foundBooks.length === 0) {
                resultsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h3>Buku tidak ditemukan</h3>
                        <p>Tidak ada buku dengan judul "${searchTerm}"</p>
                    </div>
                `;
            } else {
                foundBooks.forEach((book, index) => {
                    const bookDiv = document.createElement('div');
                    bookDiv.className = `book-item animated delay-${index % 3}`;
                    bookDiv.innerHTML = `
                        <h3>${book.judul}</h3>
                        <p><i class="fas fa-user-edit"></i> ${book.penulis}</p>
                        <p><i class="fas fa-building"></i> ${book.penerbit}</p>
                        <div class="book-meta">
                            <span><i class="fas fa-calendar-alt"></i> ${book.tahun}</span>
                            <span class="delete-btn" style="display:${currentRole === 'admin' ? 'inline' : 'none'}" onclick="deleteBook(${book.id})">
                                <i class="fas fa-trash"></i> Hapus
                            </span>
                        </div>
                    `;
                    resultsContainer.appendChild(bookDiv);
                });
            }
            document.getElementById('search-results').style.display = 'block';
            updateMenuByRole();
        }
        function deleteBook(id) {
            if (confirm('Apakah Anda yakin ingin menghapus buku ini?')) {
                books = books.filter(book => book.id !== id);
                localStorage.setItem('libraryBooks', JSON.stringify(books));
                showAlert('Buku berhasil dihapus!', 'success');
                showAllBooks();
            }
        }
        // Jika ingin langsung ke halaman utama jika sudah login sebelumnya, bisa tambahkan pengecekan di sini
        window.onload = function() {
            // Kosongkan, atau tambahkan auto-login jika diperlukan
        };
    </script>
</body>
</html>
